<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Breakable Nickel</title>
<style>
  body { margin: 0; overflow: hidden; background: #111; }
  canvas { display: block; }
</style>
</head>
<body>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cannon-es/0.20.0/cannon-es.js"></script>

<script>
// Three.js setup
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(3,2,3);

const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const controls = new THREE.OrbitControls(camera, renderer.domElement);

// Physics world
const world = new CANNON.World({
    gravity: new CANNON.Vec3(0, -9.8, 0)
});

// Light
const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(3,5,3);
scene.add(light);

// Nickel (a cylinder)
const radius = 1;
const height = 0.2;

// Visual
const nickelGeo = new THREE.CylinderGeometry(radius, radius, height, 64);
const nickelMat = new THREE.MeshStandardMaterial({color:0xcccccc, metalness:1, roughness:0.3});
const nickelMesh = new THREE.Mesh(nickelGeo, nickelMat);
scene.add(nickelMesh);

// Physics
const nickelShape = new CANNON.Cylinder(radius, radius, height, 32);
const nickelBody = new CANNON.Body({ mass:1 });
nickelBody.addShape(nickelShape);
nickelBody.position.set(0,1,0);
world.addBody(nickelBody);

// Ground
const groundBody = new CANNON.Body({ mass:0, shape:new CANNON.Plane() });
world.addBody(groundBody);

const groundMesh = new THREE.Mesh(
    new THREE.PlaneGeometry(20,20),
    new THREE.MeshStandardMaterial({color:0x333333})
);
groundMesh.rotation.x = -Math.PI/2;
scene.add(groundMesh);

// Sync physics + visuals
function updatePhysics(){
    world.step(1/60);
    nickelMesh.position.copy(nickelBody.position);
    nickelMesh.quaternion.copy(nickelBody.quaternion);
}

// Break coin into pieces
function breakNickel(){
    scene.remove(nickelMesh);
    world.removeBody(nickelBody);

    for(let i=0; i<12; i++){
        let g = new THREE.BoxGeometry(0.4,0.4,0.1);
        let m = new THREE.MeshStandardMaterial({color:0xcccccc, metalness:1});
        let chunk = new THREE.Mesh(g,m);

        chunk.position.set(
            (Math.random()-0.5)*1.5,
            1 + Math.random()*0.5,
            (Math.random()-0.5)*1.5
        );
        scene.add(chunk);

        let shape = new CANNON.Box(new CANNON.Vec3(0.2,0.2,0.05));
        let body = new CANNON.Body({ mass: 0.2 });
        body.addShape(shape);
        body.position.set(chunk.position.x, chunk.position.y, chunk.position.z);

        // random explosion force
        body.applyImpulse(new CANNON.Vec3(
            (Math.random()-0.5)*5,
            Math.random()*4,
            (Math.random()-0.5)*5
        ));

        world.addBody(body);

        chunk.body = body;
        chunk.update = function(){
            this.position.copy(this.body.position);
            this.quaternion.copy(this.body.quaternion);
        };
        pieces.push(chunk);
    }
}

let pieces = [];

// Mouse click = destroy
window.addEventListener("click", () => {
    if(pieces.length === 0){
        breakNickel();
    }
});

// Animate
function animate(){
    requestAnimationFrame(animate);
    updatePhysics();
    pieces.forEach(p => p.update());
    renderer.render(scene, camera);
}
animate();

</script>
</body>
</html>